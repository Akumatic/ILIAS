/**
 * This file is part of ILIAS, a powerful learning management system
 * published by ILIAS open source e-Learning e.V.
 *
 * ILIAS is licensed with the GPL-3.0,
 * see https://www.gnu.org/licenses/gpl-3.0.en.html
 * You should have received a copy of said license along with the
 * source code, too.
 *
 * If this is not the case or you just want to try ILIAS, you'll find
 * us at:
 * https://www.ilias.de
 * https://github.com/ILIAS-eLearning
 */
!function(e,t){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=i(e),s=i(t);s.default.WOPI={modified:!1},s.default.WOPI.bindCloseButton=function(e){a.default.getElementById(e).addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.close((()=>{alert("saved")}))}))},s.default.WOPI.init=function(){
// BUILD IFRAME
const e=a.default.getElementById("c-embedded-wopi"),t=e.getAttribute("data-token"),i=e.getAttribute("data-editor-url"),d=e.getAttribute("data-ttl"),n=a.default.createElement("iframe");
// read ttl, token and editor URL from data attributes
n.name="editor_frame",n.id="editor_frame",n.title="Office Frame",n.setAttribute("allowfullscreen","true"),n.setAttribute("allowtransparency","true"),n.setAttribute("frameBorder","0"),e.appendChild(n),this.frameholder=e,this.editorFrame=n,
// eslint-disable-next-line max-len
this.editorFrameWindow=n.contentWindow||n.contentDocument.document||n.contentDocument,this.windowResize();
// BUILD FORM
const o=a.default.createElement("form"),l=a.default.createElement("input"),r=a.default.createElement("input");o.method="POST",o.action=i,o.target="editor_frame",l.name="access_token",l.value=t,o.appendChild(l),r.name="access_token_ttl",r.value=d,o.appendChild(r),a.default.body.appendChild(o),
// SEND FORM
o.submit(),
// Add event listener to receive messages from the editor
this.registerListener("App_LoadingStatus",(e=>{"Document_Loaded"===e.Values.Status&&this.postMessage({MessageId:"Host_PostmessageReady",SendTime:Date.now(),Values:{}})})),this.registerListener("Doc_ModifiedStatus",(e=>{console.log("Documend Modified"),this.modified=e.Values.Modified??!1})),
// Add event listener to resize the editor iframe
a.default.defaultView.addEventListener("resize",(()=>{s.default.WOPI.windowResize(n)}))},s.default.WOPI.windowResize=function(){const e=this.editorFrame.parentElement.offsetWidth-0,t=a.default.getElementsByClassName("il-layout-page-content")[0].clientHeight-a.default.getElementsByClassName("il_HeaderInner")[0].clientHeight-a.default.getElementsByTagName("footer")[0].clientHeight-100;this.editorFrame.setAttribute("width",e),this.editorFrame.setAttribute("height",t)},s.default.WOPI.postMessage=function(e){this.editorFrameWindow.postMessage(JSON.stringify(e),"*")},s.default.WOPI.registerListener=async function(e,t){window.addEventListener("message",(i=>{const a=JSON.parse(i.data);null!==e&&a.MessageId===e&&t(a)}),!1)},s.default.WOPI.close=async function(e){console.log("save called");const t=a.default.createElement("div");t.id="c-embedded-wopi-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.5)",this.frameholder.appendChild(t),this.modified&&(console.log("is modified"),console.log("save"),await this.save(),await this.registerListener("Doc_ModifiedStatus",e))},s.default.WOPI.save=async function(){return this.postMessage({MessageId:"Action_Save",SendTime:Date.now(),Values:{DontTerminateEdit:!0,DontSaveIfUnmodified:!0,Notify:!1}}),!0}}(document,il);
